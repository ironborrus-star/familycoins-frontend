<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FamilyCoins - Панель управления</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="dashboard-body">
    <div id="app">
        <div class="main-layout">
            <!-- Навигация -->
            <nav class="navbar">
                <div class="nav-brand">
                    <i class="fas fa-coins"></i>
                    FamilyCoins
                    <div class="auth-status">
                        <span class="status-indicator authorized">
                            <i class="fas fa-shield-alt"></i>
                            Авторизованная зона
                        </span>
                    </div>
                </div>
                <div class="nav-user">
                    <div class="user-info">
                        <span class="user-name"></span>
                        <span class="user-role"></span>
                        <span class="user-username"></span>
                    </div>
                    <div class="coin-balance">
                        <i class="fas fa-coins"></i>
                        <span id="coin-count">0</span>
                    </div>
                    <button class="btn btn-outline" onclick="logout()" title="Выйти из системы">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </nav>
            
            <!-- Боковое меню -->
            <aside class="sidebar">
                <div class="sidebar-menu">
                    <button class="menu-item active" data-section="dashboard">
                        <i class="fas fa-home"></i>
                        Главная
                    </button>
                    <button class="menu-item" data-section="tasks">
                        <i class="fas fa-tasks"></i>
                        Задания
                    </button>
                    <button class="menu-item" data-section="store">
                        <i class="fas fa-store"></i>
                        Магазин
                    </button>
                    <button class="menu-item" data-section="coins">
                        <i class="fas fa-coins"></i>
                        Монеты
                    </button>
                    <button class="menu-item" data-section="goals">
                        <i class="fas fa-bullseye"></i>
                        Цели
                    </button>
                    <button class="menu-item parent-only" data-section="stats">
                        <i class="fas fa-chart-bar"></i>
                        Статистика
                    </button>
                    <button class="menu-item" data-section="family">
                        <i class="fas fa-users"></i>
                        Семья
                    </button>
                </div>
            </aside>
            
            <!-- Основное содержимое -->
            <main class="content">
                <!-- Дашборд -->
                <section id="dashboard-section" class="content-section active">
                    <div class="section-header">
                        <h2><i class="fas fa-home"></i> Главная</h2>
                    </div>
                    <!-- Общая статистика -->
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="dashboard-coins">0</h3>
                                <p>Монет</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-tasks"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="dashboard-total-tasks">0</h3>
                                <p>Всего заданий</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="dashboard-family">-</h3>
                                <p>Семья</p>
                            </div>
                        </div>
                    </div>

                    <!-- Статистика заданий для родителей -->
                    <div class="parent-only task-stats-section">
                        <h3><i class="fas fa-chart-pie"></i> Статистика заданий</h3>
                        <div class="task-stats-grid">
                            <div class="task-stat-card in-progress">
                                <div class="stat-icon">
                                    <i class="fas fa-play-circle"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="tasks-in-progress">0</h3>
                                    <p>В работе</p>
                                </div>
                            </div>
                            <div class="task-stat-card pending">
                                <div class="stat-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="tasks-pending">0</h3>
                                    <p>На проверке</p>
                                </div>
                            </div>
                            <div class="task-stat-card completed">
                                <div class="stat-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="tasks-completed">0</h3>
                                    <p>Завершены</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Статистика по детям для родителей -->
                    <div class="parent-only children-stats-section">
                        <h3><i class="fas fa-child"></i> Активность детей</h3>
                        <div id="children-stats" class="children-stats">
                            <!-- Статистика по детям будет загружена здесь -->
                        </div>
                    </div>
                </section>
                
                <!-- Задания -->
                <section id="tasks-section" class="content-section">
                    <div class="section-header">
                        <h2><i class="fas fa-tasks"></i> Задания</h2>
                        <button class="btn btn-primary parent-only" onclick="showCreateTaskModal()">
                            <i class="fas fa-plus"></i>
                            Создать задание
                        </button>
                    </div>
                    <!-- Для детей -->
                    <div class="child-tasks">
                        <div class="tasks-container" id="child-tasks">
                            <!-- Задания ребенка будут загружены здесь -->
                        </div>
                    </div>
                    
                    <!-- Для родителей -->
                    <div class="parent-tasks parent-only">
                        <div class="tasks-tabs">
                            <button class="tab-btn active" data-tab="active" onclick="Tasks.switchTab('active')">Активные задания</button>
                            <button class="tab-btn" data-tab="pending" onclick="Tasks.switchTab('pending')">Ожидают проверки</button>
                            <button class="tab-btn" data-tab="history" onclick="Tasks.switchTab('history')">История заданий</button>
                        </div>
                        
                        <!-- Фильтры для истории -->
                        <div id="task-filters" class="task-filters" style="display: none;">
                            <div class="filter-group">
                                <label for="status-filter">Статус:</label>
                                <select id="status-filter" onchange="Tasks.applyFilters()">
                                    <option value="all">Все статусы</option>
                                    <option value="assigned">В работе</option>
                                    <option value="completed">На проверке</option>
                                    <option value="approved">Одобрено</option>
                                    <option value="rejected">Отклонено</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="child-filter">Ребенок:</label>
                                <select id="child-filter" onchange="Tasks.applyFilters()">
                                    <option value="all">Все дети</option>
                                    <!-- Дети будут загружены динамически -->
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="period-filter">Период:</label>
                                <select id="period-filter" onchange="Tasks.applyFilters()">
                                    <option value="all">За все время</option>
                                    <option value="week">За неделю</option>
                                    <option value="month" selected>За месяц</option>
                                </select>
                            </div>
                        </div>

                        <div class="tasks-container" id="parent-tasks">
                            <!-- Задания родителя будут загружены здесь -->
                        </div>
                    </div>
                </section>
                
                <!-- Магазин -->
                <section id="store-section" class="content-section">
                    <div class="section-header">
                        <h2><i class="fas fa-store"></i> Магазин</h2>
                        <button class="btn btn-primary parent-only" onclick="showCreateItemModal()">
                            <i class="fas fa-plus"></i>
                            Добавить товар
                        </button>
                    </div>
                    <div class="store-container" id="store-container">
                        <!-- Товары будут загружены здесь -->
                    </div>
                </section>
                
                <!-- Монеты -->
                <section id="coins-section" class="content-section">
                    <div class="section-header">
                        <h2><i class="fas fa-coins"></i> Монеты</h2>
                        <button class="btn btn-primary parent-only" onclick="showAdjustCoinsModal()">
                            <i class="fas fa-edit"></i>
                            Корректировать баланс
                        </button>
                    </div>
                    <div class="coins-info">
                        <div class="balance-card">
                            <h3>Текущий баланс</h3>
                            <div class="balance-amount">
                                <i class="fas fa-coins"></i>
                                <span id="balance-amount">0</span>
                            </div>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-label">Всего заработано</span>
                                <span class="stat-value" id="total-earned">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Всего потрачено</span>
                                <span class="stat-value" id="total-spent">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="transactions-container">
                        <h3>История транзакций</h3>
                        <div class="filter-controls">
                            <select id="transaction-type-filter">
                                <option value="all">Все транзакции</option>
                                <option value="earned">Заработано</option>
                                <option value="spent">Потрачено</option>
                                <option value="adjustment">Корректировки</option>
                            </select>
                        </div>
                        <div id="transactions-list">
                            <!-- Транзакции будут загружены здесь -->
                        </div>
                    </div>
                </section>
                
                <!-- Статистика -->
                <section id="stats-section" class="content-section">
                    <div class="section-header">
                        <h2><i class="fas fa-chart-bar"></i> Статистика</h2>
                        <select id="stats-period">
                            <option value="week">За неделю</option>
                            <option value="month" selected>За месяц</option>
                        </select>
                    </div>
                    <div class="stats-container" id="stats-container">
                        <!-- Статистика будет загружена здесь -->
                    </div>
                </section>
                
                <!-- Цели -->
                <section id="goals-section" class="content-section">
                    <div class="section-header">
                        <h2><i class="fas fa-bullseye"></i> Мои цели</h2>
                        <button class="btn btn-primary" onclick="showCreateGoalModal()">
                            <i class="fas fa-plus"></i>
                            Создать цель
                        </button>
                    </div>
                    
                    <!-- Для детей -->
                    <div class="child-goals">
                        <div class="goals-container" id="child-goals">
                            <!-- Цели ребенка будут загружены здесь -->
                        </div>
                    </div>
                    
                    <!-- Для родителей -->
                    <div class="parent-goals parent-only">
                        <div class="goals-tabs">
                            <button class="tab-btn active" data-tab="family-goals" onclick="Goals.switchTab('family-goals')">Цели семьи</button>
                            <button class="tab-btn" data-tab="create-for-child" onclick="Goals.switchTab('create-for-child')">Создать для ребенка</button>
                        </div>
                        <div class="goals-container" id="parent-goals">
                            <!-- Цели семьи будут загружены здесь -->
                        </div>
                    </div>
                </section>
                
                <!-- Семья -->
                <section id="family-section" class="content-section">
                    <div class="section-header">
                        <h2><i class="fas fa-users"></i> Информация о семье</h2>
                    </div>
                    <div class="family-info">
                        <div class="family-card">
                            <div class="card-header">
                                <h3 id="family-name-display">Название семьи</h3>
                                <div class="family-id">
                                    <label>ID семьи:</label>
                                    <div class="code-container">
                                        <code id="family-id">--------</code>
                                        <button class="btn btn-sm" onclick="copyFamilyId()" title="Копировать ID семьи">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="family-code">
                                <label><i class="fas fa-key"></i> Код для присоединения:</label>
                                <div class="code-container">
                                    <code id="family-passcode">------</code>
                                    <button class="btn btn-sm" onclick="copyPasscode()" title="Копировать код">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="family-members-section">
                            <h3><i class="fas fa-users"></i> Члены семьи</h3>
                            <div id="family-members" class="family-members">
                                <!-- Члены семьи будут загружены здесь -->
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>
    
    <!-- Модальные окна -->
    <div id="modal-overlay" class="modal-overlay">
        <!-- Создание задания -->
        <div id="create-task-modal" class="modal">
            <div class="modal-header">
                <h3>Создать задание</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="create-task-form">
                    <div class="form-group">
                        <label for="task-template">Шаблон задания</label>
                        <select id="task-template" name="template_id">
                            <!-- Шаблоны будут загружены здесь -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="task-children">Назначить детям</label>
                        <div id="task-children" class="checkbox-group">
                            <!-- Дети будут загружены здесь -->
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="task-due-date">Срок выполнения</label>
                        <input type="date" id="task-due-date" name="due_date">
                    </div>
                    <div class="form-group">
                        <label for="task-coins">Награда (монеты)</label>
                        <input type="number" id="task-coins" name="coins" min="1" value="10">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Отмена</button>
                <button class="btn btn-primary" onclick="createTask()">Создать</button>
            </div>
        </div>
        
        <!-- Создание товара -->
        <div id="create-item-modal" class="modal">
            <div class="modal-header">
                <h3>Добавить товар</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="create-item-form">
                    <div class="form-group">
                        <label for="item-title">Название товара</label>
                        <input type="text" id="item-title" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="item-description">Описание</label>
                        <textarea id="item-description" name="description"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="item-cost">Стоимость (монеты)</label>
                        <input type="number" id="item-cost" name="cost" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="item-category">Категория</label>
                        <select id="item-category" name="category">
                            <option value="reward">Награда</option>
                            <option value="privilege">Привилегия</option>
                            <option value="activity">Активность</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Отмена</button>
                <button class="btn btn-primary" onclick="createStoreItem()">Добавить</button>
            </div>
        </div>

        <!-- Корректировка монет -->
        <div id="adjust-coins-modal" class="modal">
            <div class="modal-header">
                <h3>Корректировать баланс</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="adjust-coins-form">
                    <div class="form-group">
                        <label for="adjust-children">Выберите ребенка</label>
                        <div id="adjust-children" class="checkbox-group">
                            <!-- Дети будут загружены здесь -->
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="adjust-amount">Сумма корректировки</label>
                        <input type="number" id="adjust-amount" name="amount" required>
                        <small>Положительное число - добавить монеты, отрицательное - убрать</small>
                    </div>
                    <div class="form-group">
                        <label for="adjust-reason">Причина</label>
                        <input type="text" id="adjust-reason" name="reason" placeholder="Причина корректировки">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Отмена</button>
                <button class="btn btn-primary" onclick="adjustCoins()">Применить</button>
            </div>
        </div>

        <!-- Создание цели (пошаговая форма) -->
        <div id="create-goal-modal" class="modal large-modal">
            <div class="modal-header">
                <h3>
                    <span id="goal-form-title">Создать цель</span>
                    <div class="step-indicator">
                        <span class="step active" data-step="1">1</span>
                        <span class="step" data-step="2">2</span>
                        <span class="step" data-step="3">3</span>
                    </div>
                </h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Прогресс-бар -->
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="goal-progress-fill" style="width: 33.33%"></div>
                    </div>
                    <div class="progress-labels">
                        <span class="active">Исполнитель</span>
                        <span>Тип цели</span>
                        <span>Параметры</span>
                    </div>
                </div>

                <!-- Шаг 1: Выбор исполнителя -->
                <div id="goal-step-1" class="goal-step active">
                    <h4>Выберите исполнителя цели</h4>
                    <div id="executor-options" class="executor-grid">
                        <!-- Исполнители будут загружены здесь -->
                    </div>
                </div>

                <!-- Шаг 2: Выбор типа цели -->
                <div id="goal-step-2" class="goal-step">
                    <h4>Выберите тип цели</h4>
                    <div id="goal-type-options" class="goal-type-grid">
                        <!-- Типы целей будут загружены здесь -->
                    </div>
                </div>

                <!-- Шаг 3: Параметры цели -->
                <div id="goal-step-3" class="goal-step">
                    <h4 id="goal-step-3-title">Настройте параметры цели</h4>
                    
                    <!-- Общие параметры -->
                    <div class="goal-basic-params">
                        <div class="form-group">
                            <label for="goal-title">Название цели</label>
                            <input type="text" id="goal-title" name="title" required maxlength="200">
                        </div>
                        <div class="form-group">
                            <label for="goal-description">Описание (необязательно)</label>
                            <textarea id="goal-description" name="description" rows="3"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="goal-deadline">Срок достижения</label>
                                <input type="date" id="goal-deadline" name="deadline">
                            </div>
                            <div class="form-group">
                                <label for="goal-reward">Бонусные монеты</label>
                                <input type="number" id="goal-reward" name="reward_coins" min="0" value="50">
                            </div>
                        </div>
                    </div>

                    <!-- Параметры для товара из магазина -->
                    <div id="store-item-params" class="goal-type-params" style="display: none;">
                        <h5><i class="fas fa-shopping-cart"></i> Выбор товара</h5>
                        <div id="store-items-grid" class="store-items-selection">
                            <!-- Товары будут загружены здесь -->
                        </div>
                    </div>

                    <!-- Параметры для привычки -->
                    <div id="habit-params" class="goal-type-params" style="display: none;">
                        <h5><i class="fas fa-calendar-check"></i> Настройки привычки</h5>
                        <div class="habit-config">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="habit-actions">Количество действий</label>
                                    <input type="number" id="habit-actions" name="habit_actions" min="1" value="10">
                                    <small>Сколько раз нужно выполнить действие</small>
                                </div>
                                <div class="form-group">
                                    <label for="habit-period">Период</label>
                                    <div class="period-inputs">
                                        <input type="number" id="habit-period-value" name="habit_period_value" min="1" value="30">
                                        <select id="habit-period-type" name="habit_period_type">
                                            <option value="days">дней</option>
                                            <option value="weeks">недель</option>
                                            <option value="months">месяцев</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="habit-streak" name="habit_streak">
                                    Требуется выполнение подряд (без пропусков)
                                </label>
                            </div>
                            
                            <h6>Награда за выполнение</h6>
                            <div class="reward-config">
                                <div class="form-group">
                                    <label for="habit-reward-type">Тип награды</label>
                                    <select id="habit-reward-type" name="habit_reward_type" onchange="GoalForm.onHabitRewardTypeChange()">
                                        <option value="coins">Монеты</option>
                                        <option value="store_item">Товар из магазина</option>
                                    </select>
                                </div>
                                <div id="habit-coins-reward" class="form-group">
                                    <label for="habit-reward-coins">Количество монет</label>
                                    <input type="number" id="habit-reward-coins" name="habit_reward_coins" min="0" value="100">
                                </div>
                                <div id="habit-item-reward" class="form-group" style="display: none;">
                                    <label for="habit-reward-item">Товар-награда</label>
                                    <select id="habit-reward-item" name="habit_reward_item">
                                        <!-- Товары будут загружены здесь -->
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Параметры для накопления монет -->
                    <div id="coin-saving-params" class="goal-type-params" style="display: none;">
                        <h5><i class="fas fa-coins"></i> Накопление монет</h5>
                        <div class="form-group">
                            <label for="coin-target">Целевая сумма</label>
                            <input type="number" id="coin-target" name="coin_target" min="1" value="500">
                            <small>Сколько монет нужно накопить</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="goal-prev-btn" onclick="GoalForm.prevStep()" style="display: none;">
                    <i class="fas fa-chevron-left"></i> Назад
                </button>
                <button class="btn btn-secondary" onclick="closeModal()">Отмена</button>
                <button class="btn btn-primary" id="goal-next-btn" onclick="GoalForm.nextStep()">
                    Далее <i class="fas fa-chevron-right"></i>
                </button>
                <button class="btn btn-success" id="goal-create-btn" onclick="GoalForm.createGoal()" style="display: none;">
                    <i class="fas fa-plus"></i> Создать цель
                </button>
            </div>
        </div>
        
        <!-- Детали цели -->
        <div id="goal-details-modal" class="modal">
            <div class="modal-header">
                <h3>Детали цели</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="goal-details-content">
                    <!-- Детали цели будут загружены здесь -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Закрыть</button>
                <div id="goal-action-buttons">
                    <!-- Кнопки действий будут добавлены динамически -->
                </div>
            </div>
        </div>

        <!-- Детальный профиль ребенка -->
        <div id="child-profile-modal" class="modal large-modal">
            <div class="modal-header">
                <h3><i class="fas fa-child"></i> Профиль ребенка: <span id="child-profile-name"></span></h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Общая информация -->
                <div class="child-profile-overview">
                    <div class="profile-card">
                        <div class="profile-avatar">
                            <i class="fas fa-child"></i>
                            <span id="child-avatar-letter"></span>
                        </div>
                        <div class="profile-info">
                            <h4 id="child-name-display"></h4>
                            <p id="child-username-display"></p>
                            <div class="profile-stats">
                                <div class="profile-stat">
                                    <span class="stat-value" id="child-coin-balance">0</span>
                                    <span class="stat-label">Монет</span>
                                </div>
                                <div class="profile-stat">
                                    <span class="stat-value" id="child-total-tasks">0</span>
                                    <span class="stat-label">Всего заданий</span>
                                </div>
                                <div class="profile-stat">
                                    <span class="stat-value" id="child-completed-tasks">0</span>
                                    <span class="stat-label">Выполнено</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Вкладки профиля -->
                <div class="profile-tabs">
                    <button class="profile-tab-btn active" data-tab="tasks" onclick="ChildProfile.switchTab('tasks')">Задания</button>
                    <button class="profile-tab-btn" data-tab="coins" onclick="ChildProfile.switchTab('coins')">Монеты</button>
                    <button class="profile-tab-btn" data-tab="goals" onclick="ChildProfile.switchTab('goals')">Цели</button>
                </div>

                <!-- Содержимое вкладок -->
                <div class="profile-content">
                    <!-- Вкладка заданий -->
                    <div id="profile-tasks-tab" class="profile-tab-content active">
                        <div class="task-filters-row">
                            <div class="filter-group">
                                <label>Период:</label>
                                <select id="child-period-filter" onchange="ChildProfile.applyFilters()">
                                    <option value="all">За все время</option>
                                    <option value="day">За день</option>
                                    <option value="week">За неделю</option>
                                    <option value="month" selected>За месяц</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Статус:</label>
                                <select id="child-status-filter" onchange="ChildProfile.applyFilters()">
                                    <option value="all">Все статусы</option>
                                    <option value="assigned">В работе</option>
                                    <option value="completed">На проверке</option>
                                    <option value="approved">Выполнено</option>
                                    <option value="rejected">Отклонено</option>
                                </select>
                            </div>
                        </div>
                        <div class="child-task-stats-grid">
                            <div class="child-task-stat-card assigned">
                                <div class="stat-icon"><i class="fas fa-play-circle"></i></div>
                                <div class="stat-info">
                                    <span class="stat-value" id="child-assigned-count">0</span>
                                    <span class="stat-label">В работе</span>
                                </div>
                            </div>
                            <div class="child-task-stat-card completed">
                                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                                <div class="stat-info">
                                    <span class="stat-value" id="child-completed-count">0</span>
                                    <span class="stat-label">На проверке</span>
                                </div>
                            </div>
                            <div class="child-task-stat-card approved">
                                <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                                <div class="stat-info">
                                    <span class="stat-value" id="child-approved-count">0</span>
                                    <span class="stat-label">Выполнено</span>
                                </div>
                            </div>
                            <div class="child-task-stat-card rejected">
                                <div class="stat-icon"><i class="fas fa-times-circle"></i></div>
                                <div class="stat-info">
                                    <span class="stat-value" id="child-rejected-count">0</span>
                                    <span class="stat-label">Отклонено</span>
                                </div>
                            </div>
                        </div>
                        <div id="child-tasks-list" class="child-tasks-list">
                            <!-- Список заданий ребенка -->
                        </div>
                    </div>

                    <!-- Вкладка монет -->
                    <div id="profile-coins-tab" class="profile-tab-content">
                        <div class="coins-overview">
                            <div class="coins-stat-card">
                                <h4>Заработано всего</h4>
                                <div class="coins-amount earned" id="child-total-earned">0</div>
                            </div>
                            <div class="coins-stat-card">
                                <h4>Потрачено всего</h4>
                                <div class="coins-amount spent" id="child-total-spent">0</div>
                            </div>
                            <div class="coins-stat-card">
                                <h4>Текущий баланс</h4>
                                <div class="coins-amount balance" id="child-current-balance">0</div>
                            </div>
                        </div>
                        <div id="child-transactions-list" class="transactions-list">
                            <!-- История транзакций ребенка -->
                        </div>
                    </div>

                    <!-- Вкладка целей -->
                    <div id="profile-goals-tab" class="profile-tab-content">
                        <div id="child-goals-list" class="goals-list">
                            <!-- Цели ребенка -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast контейнер -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Подключаем JavaScript -->
    <script src="app.js"></script>
    <script>
        // Инициализация dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Проверяем авторизацию
            if (!Auth.loadFromStorage()) {
                // Если пользователь не авторизован, перенаправляем на страницу входа
                window.location.href = 'login.html';
                return;
            }

            // Инициализируем основной экран
            Auth.initMainScreen();

            // Переключение секций в главном экране
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.dataset.section;
                    UI.showSection(section);
                    
                    // Загружаем данные для секции
                    switch(section) {
                        case 'dashboard':
                            Auth.loadDashboard();
                            break;
                        case 'tasks':
                            Tasks.loadMyTasks();
                            break;
                        case 'store':
                            Store.loadItems();
                            break;
                        case 'coins':
                            Coins.loadBalance();
                            Coins.loadTransactions();
                            break;
                        case 'goals':
                            Goals.loadMyGoals();
                            break;
                        case 'stats':
                            Stats.loadStats();
                            break;
                        case 'family':
                            Auth.loadFamilyData();
                            break;
                    }
                });
            });

            // Обработчики фильтров
            document.getElementById('transaction-type-filter').addEventListener('change', function() {
                Coins.loadTransactions(this.value);
            });

            document.getElementById('stats-period').addEventListener('change', function() {
                Stats.loadStats(this.value);
            });

            // Обработчик клика по overlay модального окна
            document.getElementById('modal-overlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            // Автоматическая загрузка данных при смене вкладок
            document.addEventListener('change', function(e) {
                if (e.target.matches('input[type="radio"][name="tab"]')) {
                    // Загружаем данные для выбранной вкладки
                }
            });
        });

        // Функция выхода из системы
        function logout() {
            Auth.logout();
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>